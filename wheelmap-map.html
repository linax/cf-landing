<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa de Accesibilidad</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Accessibility Cloud CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sozialhelden/accessibility-cloud-js@3.2.1/build/example/accessibility.cloud-3.2.1-2350f78a.css" />
    <style>
      #map {
        height: 500px;
        width: 100%;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Lugares accesibles en Berlín</h1>
    <div id="map"></div>
    <div id="accessibility-cloud-results"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Accessibility Cloud JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/sozialhelden/accessibility-cloud-js@3.2.1/build/example/accessibility.cloud-3.2.1-21a6710d.min.js"></script>

    <!-- Nuestro Script -->
    <script type="text/javascript">
      // Inicializa el mapa
      const map = L.map("map").setView([52.5243, 13.4063], 14) // Berlín
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map)

      // Configuración de Accessibility Cloud
      window.onAccessibilityCloudLoaded = function (AccessibilityCloud) {
        const element = document.getElementById("accessibility-cloud-results")

        AccessibilityCloud.render(element, {
          token: "d5429cd685c20a7d0a1166b7d929aa26",
          locale: "de_DE",
          requestParameters: {
            latitude: 52.5243,
            longitude: 13.4063,
            accuracy: 1000,
            limit: 20,
            filter: "at-least-partially-accessible-by-wheelchair"
          },
          // Callback cuando los lugares se cargan
          onPlacesLoaded: function (places) {
            places.forEach(place => {
              if (place.location?.latitude && place.location?.longitude) {
                const marker = L.marker([place.location.latitude, place.location.longitude]).addTo(map).bindPopup(`
                                    <strong>${place.name || "Lugar sin nombre"}</strong><br>
                                    ${place.accessibilityDescription || "Sin descripción de accesibilidad"}
                                `)
              }
            })
          },
          // Manejo de errores
          onError: function (error) {
            console.error("Error al cargar datos:", error)
            alert("No se pudieron cargar los lugares. Revisa la consola para más detalles.")
          }
        })
      }
    </script>
  </body>
</html>
